server {
  listen 80;
  server_name localhost;

  root /usr/share/nginx/html;
  index index.html index.php;

  # Serve React SPA
  location ^~ /checklistv2/ {
    alias /usr/share/nginx/html/checklistv2/;
    try_files $uri $uri/ /checklistv2/index.html;
  }

  # PHP-FPM handler: ensure POST is handled correctly
  location ~ ^/checklistv2/api/(.+\.php)(/.*)?$ {
    root /var/www/html;
    fastcgi_pass react-php:9000;
    fastcgi_index index.php;
    fastcgi_split_path_info ^(.+\.php)(/.*)$;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_param PATH_INFO $fastcgi_path_info;
    fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;
    include fastcgi_params;

    # Ensure GET and POST are allowed
    limit_except GET POST {
      deny all;
    }
  }

  # Fallback for API endpoint (if not caught above)
  location /checklistv2/api/ {
    try_files $uri $uri/ /checklistv2/api/index.php?$query_string;
  }
}
